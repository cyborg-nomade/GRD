ALTER TABLE "GRD"."GRD_GROUPS" DROP CONSTRAINT "FK_Acoes_Group"
/

ALTER TABLE "GRD"."GRD_GROUPS" DROP CONSTRAINT "FK_Participantes_Group"
/

ALTER TABLE "GRD"."GRD_GROUPS" DROP CONSTRAINT "FK_Proposicoes_Group"
/

ALTER TABLE "GRD"."GRD_PARTICIPANTES" DROP CONSTRAINT "FK_Votos_Participante"
/

ALTER TABLE "GRD"."GRD_USERS" DROP CONSTRAINT "FK_Andamentos_Users"
/

ALTER TABLE "GRD"."GRD_USERS" DROP CONSTRAINT "FK_LogsAcao_User"
/

ALTER TABLE "GRD"."GRD_USERS" DROP CONSTRAINT "FK_LogsProposicao_User"
/

ALTER TABLE "GRD"."GRD_USERS" DROP CONSTRAINT "FK_LogsReuniao_User"
/

ALTER TABLE "GRD"."GRD_USERS" DROP CONSTRAINT "FK_Participantes_User"
/

ALTER TABLE "GRD"."GRD_USERS" DROP CONSTRAINT "FK_Proposicoes_User"
/

DROP INDEX "IX_GRD_USERS_LogAcaoId"
/

DROP INDEX "IX_GRD_USERS_LogProposicaoId"
/

DROP INDEX "IX_GRD_USERS_LogReuniaoId"
/

DROP INDEX "IX_GRD_USERS_ParticipanteId"
/

DROP INDEX "IX_GRD_USERS_ProposicaoId"
/

DROP INDEX "IX_GRD_GROUPS_ParticipanteId"
/

DROP INDEX "IX_GRD_GROUPS_ProposicaoId"
/

ALTER TABLE "GRD"."GRD_USERS" DROP COLUMN "LogAcaoId"
/

ALTER TABLE "GRD"."GRD_USERS" DROP COLUMN "LogProposicaoId"
/

ALTER TABLE "GRD"."GRD_USERS" DROP COLUMN "LogReuniaoId"
/

ALTER TABLE "GRD"."GRD_USERS" DROP COLUMN "ParticipanteId"
/

ALTER TABLE "GRD"."GRD_USERS" DROP COLUMN "ProposicaoId"
/

ALTER TABLE "GRD"."GRD_GROUPS" DROP COLUMN "ParticipanteId"
/

ALTER TABLE "GRD"."GRD_GROUPS" DROP COLUMN "ProposicaoId"
/

ALTER TABLE "GRD"."GRD_VOTOS" ADD "ParticipanteId" NUMBER(10) DEFAULT 0 NOT NULL
/

declare
   l_nullable all_tab_columns.nullable % type;
begin 
   select nullable into l_nullable 
   from all_tab_columns 
  where table_name = 'GRD_USERS' 
  and column_name = 'Id' 
   and owner = 'GRD'; 
   if l_nullable = 'N' then 
        EXECUTE IMMEDIATE 'ALTER TABLE "GRD"."GRD_USERS" MODIFY "Id" NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY ';
 else 
        EXECUTE IMMEDIATE 'ALTER TABLE "GRD"."GRD_USERS" MODIFY "Id" NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY NOT NULL';
 end if;
end;
/

ALTER TABLE "GRD"."GRD_PROPOSICOES" ADD "AreaSolicitanteId" NUMBER(10) DEFAULT 0 NOT NULL
/

ALTER TABLE "GRD"."GRD_PROPOSICOES" ADD "CriadorId" NUMBER(10) DEFAULT 0 NOT NULL
/

declare
   l_nullable all_tab_columns.nullable % type;
begin 
   select nullable into l_nullable 
   from all_tab_columns 
  where table_name = 'GRD_PARTICIPANTES' 
  and column_name = 'Id' 
   and owner = 'GRD'; 
   if l_nullable = 'N' then 
        EXECUTE IMMEDIATE 'ALTER TABLE "GRD"."GRD_PARTICIPANTES" MODIFY "Id" NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY ';
 else 
        EXECUTE IMMEDIATE 'ALTER TABLE "GRD"."GRD_PARTICIPANTES" MODIFY "Id" NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY NOT NULL';
 end if;
end;
/

ALTER TABLE "GRD"."GRD_PARTICIPANTES" ADD "DiretoriaAreaId" NUMBER(10) DEFAULT 0 NOT NULL
/

ALTER TABLE "GRD"."GRD_PARTICIPANTES" ADD "UserId" NUMBER(10) DEFAULT 0 NOT NULL
/

ALTER TABLE "GRD"."GRD_LOGS_REUNIAO" ADD "UsuarioRespId" NUMBER(10) DEFAULT 0 NOT NULL
/

ALTER TABLE "GRD"."GRD_LOGS_PROPOSICAO" ADD "UsuarioRespId" NUMBER(10) DEFAULT 0 NOT NULL
/

ALTER TABLE "GRD"."GRD_LOGS_ACAO" ADD "UsuarioRespId" NUMBER(10) DEFAULT 0 NOT NULL
/

declare
   l_nullable all_tab_columns.nullable % type;
begin 
   select nullable into l_nullable 
   from all_tab_columns 
  where table_name = 'GRD_GROUPS' 
  and column_name = 'Id' 
   and owner = 'GRD'; 
   if l_nullable = 'N' then 
        EXECUTE IMMEDIATE 'ALTER TABLE "GRD"."GRD_GROUPS" MODIFY "Id" NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY ';
 else 
        EXECUTE IMMEDIATE 'ALTER TABLE "GRD"."GRD_GROUPS" MODIFY "Id" NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY NOT NULL';
 end if;
end;
/

ALTER TABLE "GRD"."GRD_ANDAMENTOS" ADD "UserId" NUMBER(10) DEFAULT 0 NOT NULL
/

ALTER TABLE "GRD"."GRD_ACOES" ADD "DiretoriaResId" NUMBER(10) DEFAULT 0 NOT NULL
/

CREATE UNIQUE INDEX "GRD"."IX_GRD_VOTOS_ParticipanteId" ON "GRD"."GRD_VOTOS" ("ParticipanteId")
/

CREATE UNIQUE INDEX "GRD"."IX_GRD_PROPOSICOES_AreaSoltId" ON "GRD"."GRD_PROPOSICOES" ("AreaSolicitanteId")
/

CREATE UNIQUE INDEX "GRD"."IX_GRD_PROPOSICOES_CriadorId" ON "GRD"."GRD_PROPOSICOES" ("CriadorId")
/

CREATE UNIQUE INDEX "GRD"."IX_GRD_PARTICIPANTES_DirAreaId" ON "GRD"."GRD_PARTICIPANTES" ("DiretoriaAreaId")
/

CREATE UNIQUE INDEX "GRD"."IX_GRD_PARTICIPANTES_UserId" ON "GRD"."GRD_PARTICIPANTES" ("UserId")
/

CREATE UNIQUE INDEX "GRD"."IX_GRD_LOGS_REUNIAO_UsuarioRespId" ON "GRD"."GRD_LOGS_REUNIAO" ("UsuarioRespId")
/

CREATE UNIQUE INDEX "GRD"."IX_GRD_LOGS_PROPOSICAO_UsuarioRespId" ON "GRD"."GRD_LOGS_PROPOSICAO" ("UsuarioRespId")
/

CREATE UNIQUE INDEX "GRD"."IX_GRD_LOGS_ACAO_UsuarioRespId" ON "GRD"."GRD_LOGS_ACAO" ("UsuarioRespId")
/

CREATE UNIQUE INDEX "GRD"."IX_GRD_ANDAMENTOS_UserId" ON "GRD"."GRD_ANDAMENTOS" ("UserId")
/

CREATE UNIQUE INDEX "GRD"."IX_GRD_ACOES_DiretoriaResId" ON "GRD"."GRD_ACOES" ("DiretoriaResId")
/

ALTER TABLE "GRD"."GRD_ACOES" ADD CONSTRAINT "FK_Acoes_Group" FOREIGN KEY ("DiretoriaResId") REFERENCES "GRD"."GRD_GROUPS" ("Id")
/

ALTER TABLE "GRD"."GRD_ANDAMENTOS" ADD CONSTRAINT "FK_Andamentos_Users" FOREIGN KEY ("UserId") REFERENCES "GRD"."GRD_USERS" ("Id")
/

ALTER TABLE "GRD"."GRD_LOGS_ACAO" ADD CONSTRAINT "FK_LogsAcao_User" FOREIGN KEY ("UsuarioRespId") REFERENCES "GRD"."GRD_USERS" ("Id")
/

ALTER TABLE "GRD"."GRD_LOGS_PROPOSICAO" ADD CONSTRAINT "FK_LogsProposicao_User" FOREIGN KEY ("UsuarioRespId") REFERENCES "GRD"."GRD_USERS" ("Id")
/

ALTER TABLE "GRD"."GRD_LOGS_REUNIAO" ADD CONSTRAINT "FK_LogsReuniao_User" FOREIGN KEY ("UsuarioRespId") REFERENCES "GRD"."GRD_USERS" ("Id")
/

ALTER TABLE "GRD"."GRD_PARTICIPANTES" ADD CONSTRAINT "FK_Participantes_Group" FOREIGN KEY ("DiretoriaAreaId") REFERENCES "GRD"."GRD_GROUPS" ("Id")
/

ALTER TABLE "GRD"."GRD_PARTICIPANTES" ADD CONSTRAINT "FK_Participantes_User" FOREIGN KEY ("UserId") REFERENCES "GRD"."GRD_USERS" ("Id")
/

ALTER TABLE "GRD"."GRD_PROPOSICOES" ADD CONSTRAINT "FK_Proposicoes_Group" FOREIGN KEY ("AreaSolicitanteId") REFERENCES "GRD"."GRD_GROUPS" ("Id")
/

ALTER TABLE "GRD"."GRD_PROPOSICOES" ADD CONSTRAINT "FK_Proposicoes_User" FOREIGN KEY ("CriadorId") REFERENCES "GRD"."GRD_USERS" ("Id")
/

ALTER TABLE "GRD"."GRD_VOTOS" ADD CONSTRAINT "FK_Votos_Participante" FOREIGN KEY ("ParticipanteId") REFERENCES "GRD"."GRD_PARTICIPANTES" ("Id")
/

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES (N'20220802150437_FixOneToOneForeignKeys', N'6.0.7')
/

